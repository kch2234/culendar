<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layouts/base :: base(~{this::content})}">
    <h1>회원 페이지 영역</h1>
<th:block th:fragment="content">
    <div name="memberProfile">  <!--  회원 프로필 영역  -->
        <span name="memberImage"></span>  <!--  회원 프로필 사진  -->
        <!-- TODO: 추가 예정 -->
        <span name="memberInfo">  <!--  회원 정보 영역  -->
            <div name="memberInfoTop">  <!--  회원 정보 상단  -->
                <span name="username"></span>  <!--  닉네임  -->
                <input type="text" th:field="${member.username}" id="username" readonly>
                <div>
                <span name="following">
                    <!-- 팔로잉 모달 버튼-->
                    <button type="button" class="btn-sm btn-primary" data-toggle="modal" data-target="#followModal">팔로잉 모달</button>
                </span>  <!--  팔로잉  -->
                <span name="follower">
                    <!-- 팔로잉 모달 버튼-->
                    <button type="button" class="btn-sm btn-primary" data-toggle="modal" data-target="#exampleModal2">팔로워 모달</button>
                </span>  <!--  팔로워  -->
                </div>
                <span name="edit-button"></span>  <!--  프로필 수정 버튼  -->
                <button type="button" class="btn btn-warning" th:onclick="|location.href='@{/members/{id}/edit(id=${member.id})}'|">프로필 수정</button>
            </div>
            <div name="memberInfoBottom">  <!--  회원 정보 하단  -->
                <span name="location"></span>  <!--  지역  -->
                <input type="text" th:field="${member.location}" id="location" readonly>
                <span name="introduce"></span>  <!--  자기소개  -->
                <input type="text" th:field="${member.introduction}" id="introduction" readonly>
                <span name="memberTest-button"></span>  <!--  성향테스트 페이지 이동 버튼  -->
                <button type="button" class="btn btn-info" th:onclick="|location.href='@{/members/{id}/memberTest(id=${member.id})}'|">성향테스트</button>
            </div>
        </span>  <!--  회원 정보 영역  -->
        </form>
    </div>  <!--  회원 프로필 영역 END  -->
    <div name="filter">  <!--  필터링 (카테고리) 영역  -->
        <span name="myFilter">  <!--  회원(나) 관련 필터 영역 / TODO 해당 카드에 등록버튼 삭제  -->
            <span name="reviewBoard"></span>  <!--  내가 쓴 후기 게시글  -->
            <span name="infoBoard"></span>  <!--  내가 쓴 정보 게시글  -->
            <span name="program"></span>  <!--  내가 관람한 작품 / TODO 관람 기준?  -->
            <span name="applyMeeting"></span>  <!--  내가 신청한 모임  -->
            <span name="createMeeting"></span>  <!--  내가 만든 모임  -->
        </span>
        <span 4name="bookmark">  <!--  북마크 필터 영역 / TODO 해당 카드에 북마크 버튼 삭제  -->
            <span name="reviewBoard"></span>  <!--  북마크한 후기 게시글  -->
            <span name="infoBoard"></span>  <!--  북마크한 정보 게시글  -->
            <span name="program"></span>  <!--  북마크한 작품  -->
            <span name="meeting"></span>  <!--  북마크한 모임  -->
        </span>
        <span name="timeline">  <!--  타임라인 (팔로잉 회원 관련) 필터 영역  -->
            <span name="reviewBoard"></span>  <!--  팔로잉 회원이 쓴 후기 게시글  -->
            <span name="infoBoard"></span>  <!--  팔로잉 회원의 정보 게시글  -->
            <span name="program"></span>  <!--  팔로잉 회원이 관람한 작품  -->
        </span>
    </div>  <!--  회원(나) 관련 필터 영역 END  -->
    <div name="cards">
        <h1>카드 영역</h1>
        <span name="{filter}Card"></span>
        <span name="{filter}Card"></span>
        <span name="{filter}Card"></span>
        <span name="{filter}Card"></span>
    </div>
    <!--  무한 스크롤 영역  -->
    <!-- 모달 버튼
        <button type="button" class="btn-sm btn-primary" data-toggle="modal" data-target="#exampleModal">모달 열기</button>
        -->
    <!-- 팔로잉 모달 -->
        <div class="modal fade" id="followModal" tabindex="-1" role="dialog" aria-labelledby="followModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="followModalLabel">팔로잉</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-dialog modal-dialog-scrollable"><!-- 스크롤 모달 -->
                    <div class="modal-body">
                        <form>
                            <div class="card-body" id="followList"></div>
                        </form>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="card-body" id="memberList"></div>
                        </form>
                    </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                    </div>
                </div>
            </div>
        </div>
</th:block>
</th:block>
<script th:inline="javascript">
    $(document).ready(function(){
        let memberIdVal = [[${member.id}]] // 회원 id
        let flowListDiv = $('#followList'); // 팔로잉 리스트 div
        let memberListDiv = $('#memberList'); // 팔로잉 리스트 div

        getFollowingList();

        function getFollowingList() {
            $.ajax({
                type: 'GET',
                url: '/follows/' + memberIdVal,
                success: function (result){
                    console.log("팔로잉 리스트 가져오기 성공");
                    console.log(result);
                    printFollowList(result.followingList);
                    printMemberList(result.memberList);
                },
                error: function (e){
                    console.log("팔로잉 리스트 가져오기 실패");
                    console.log(e);
                }
            });
        }
        function printFollowList(list) {
            let html = '';
            for (let i = 0; i < list.length; i++) {
                html += '<div name="member">';
                html += '<span name="memberImage">프로필 사진</span>';
                html += '<input type="text" id="profileImage" readonly>';
                html += '<span name="memberInfo">';
                html += '<div name="username">닉네임';
                html += '<input type="text" value="' + list[i].username + '" id="username" readonly>';
                html += '</div>';
                html += '<div name="memberInfoBottom">';
                html += '<span name="location">지역</span>';
                html += '<input type="text" value="' + list[i].location + '" id="location" readonly>';
                html += '<span name="introduce">자기소개</span>';
                html += '<input type="text" value="' + list[i].introduction + '" id="introduction" readonly>';
                html += '</div>';
                html += '</span>';
                html += '<span name="follow-button"></span>';
                html += '<button type="button" class="btn btn-secondary" id="unFollowBtn">팔로잉</button>';
                html += '</div>';
            }
            flowListDiv.html(html);
        }

        function printMemberList(memberList) {
            let html = '';
            for (let i = 0; i < memberList.length; i++) {
                html += '<div name="member">';
                html += '<span name="memberImage">프로필 사진</span>';
                html += '<input type="text" id="profileImage" readonly>';
                html += '<span name="memberInfo">';
                html += '<div name="username">닉네임';
                html += '<input type="text" value="' + memberList[i].username + '" id="username" readonly>';
                html += '</div>';
                html += '<div name="memberInfoBottom">';
                html += '<span name="location">지역</span>';
                html += '<input type="text" value="' + memberList[i].location + '" id="location" readonly>';
                html += '<span name="introduce">자기소개</span>';
                html += '<input type="text" value="' + memberList[i].introduction + '" id="introduction" readonly>';
                html += '</div>';
                html += '</span>';
                html += '<span name="follow-button"></span>';
                html += '<button type="button" class="btn btn-primary" id="flwBtn">팔로우</button>';
                html += '</div>';
            }
            memberListDiv.html(html);
        }
        // 팔로우 버튼 클릭 이벤트
        $("#flwBtn").on("click", function(){
            console.log("팔로우 버튼 클릭");
            let mid = [[${member.id}]]
            let data = {
                memberId: mid,
                followingId: mid
            }
            console.log(data);
            saveFollow(data, function (){
                getFollowingList();
            });
        });
        function saveFollow(data, callback) {
            $.ajax({
                type: 'POST',
                url: '/follows/follow',
                data: JSON.stringify(data),
                contentType: 'application/json; charset=utf-8',
                success: function (result){
                    console.log("팔로우 성공");
                    console.log(result);
                    callback();
                },
                error: function (e){
                    console.log("팔로우 실패");
                    console.log(e);
                }
            });
        }


    });
</script>
</html>