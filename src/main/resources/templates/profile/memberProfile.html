<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<th:block th:replace="~{/layouts/base :: base(~{this::content})}">

    <th:block th:fragment="content">

        <!-- 팔로우 목록 모달 -->
        <div class="modal fade" id="followList-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content" id="test1">
                    <div class="modal-header" id="test2">
                        <h1 class="modal-title fs-5">내 팔로우 목록</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body container" id="followingListModalBody">

                        <!-- 팔로우 목록 양식-->
                        <!--<div class="row">

                            &lt;!&ndash; 프로필 &ndash;&gt;
                            <div class="col-2">
                                <i class="fa-solid fa-circle-user fa-2x d-flex justify-content-center align-items-center"></i>
                            </div>

                            <div class="col">
                                <div class="row d-flex justify-content-between align-items-center">
                                    &lt;!&ndash; 닉네임, 지역 &ndash;&gt;
                                    <div class="col-auto">
                                        <div class="input-group">
                                            <button type="button" class="btn btn-outline-secondary">asd</button>
                                            <span class="input-group-text">지역</span>
                                        </div>
                                    </div>

                                    &lt;!&ndash; 팔로우 버튼 &ndash;&gt;
                                    <div class="col-auto">
                                        <div class="input-group">
                                            <button type="button" class="btn btn-dark">UnFollow</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>-->

                    </div>
                </div>
            </div>
        </div>

        <!-- TODO 마이페이지 기능 구현 및 디자인 -->

        <!-- 프로필 페이지 영역 -->
        <div class="container" id="profileWrapper">

            <!-- 기본 정보 영역 -->
            <div class="row mt-5">

                <!-- 프로필 & 기본 정보 -->
                <div class="row mt-4">

                    <!-- 프로필 이미지 -->
                    <div class="col-3">
                        <i class="fa-solid fa-circle-user fa-7x d-flex justify-content-center align-items-center"></i>
                    </div>

                    <!-- 프로필 정보 -->
                    <div class="col-9">
                        <!-- 닉네임, 팔로우, 팔로워 -->
                        <div class="row">
                            <!-- 닉네임 -->
                            <div class="col-auto">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">닉네임</span>
                                    <span class="form-control" th:text="${member.username}"></span>
                                </div>
                            </div>
                            <!-- 팔로우 -->
                            <div class="col">
                                <div class="input-group input-group-lg d-flex justify-content-center align-items-center">
                                    <span class="input-group-text">팔로우</span>
                                    <button type="button" id="followNum" data-bs-target="#followList-modal" data-bs-toggle="modal" class="btn btn-outline-secondary">10명</button>
                                </div>

                            </div>
                            <!-- 팔로워 -->
                            <div class="col">
                                <div class="input-group input-group-lg d-flex justify-content-center align-items-center">
                                    <span class="input-group-text">팔로워</span>
                                    <button type="button" id="followerNum" class="btn btn-outline-secondary">10명
                                    </button>
                                </div>
                            </div>

                            <!-- 수정 버튼 -->
                            <div class="col-auto">
                                <div class="input-group input-group-lg">
                                    <button type="button" class="btn btn-dark"
                                            th:onclick="|location.href='@{/members/{id}/edit(id=${member.id})}'|">수정
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 지역, 자기소개 -->
                        <div class="row mt-3">

                            <div class="col-auto">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text" th:text="${member.location.value}">지역</span>
                                </div>
                            </div>

                            <div class="col">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">자기소개</span>
                                    <span class="form-control" th:text="${member.introduction}"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- 필터 영역 -->
                <div class="row mt-5">

                    <!-- 동적 제목 -->
                    <div class="col-3">
                        <div class="input-group input-group-lg w-100 h-100">
                            <span class="btn btn-secondary w-100 h-100 fs-2 d-flex justify-content-center align-items-center">카테고리</span>
                        </div>
                    </div>

                    <!-- 필터 버튼 -->
                    <!-- 나 : 후기, 정보, 작품, 신청한 모임 일정, 등록한 모임 일정 -->
                    <!-- 북마크 : 후기, 정보, 작품, 모임 -->
                    <!-- 타임 라인 : 후기, 정보, 작품 -->
                    <div class="col-9">
                        <div class="row">
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-4">나</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-4">북마크</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-4">타임라인</button>
                            </div>
                            <div class="col"></div>
                            <div class="col"></div>
                        </div>

                        <!-- 세부 동적 필터 -->
                        <div class="row mt-3">
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">후기</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">정보</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">작품</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">신청한 모임</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">등록한 모임</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 카드 영역 -->
            <div id="content-area" class="mt-4">

                <div id="contentTest">asdasd</div>

            </div>


        </div>

        <!--  무한 스크롤 영역  -->


    </th:block>
</th:block>
<script th:inline="javascript">
    $(document).ready(function () {
        let memberIdVal = [[${member.id}]];

        console.log("memberIdVal : " + memberIdVal);

        let followingStart = 0;

        // ********* 페이지 로딩시 함수 **********

        // 팔로잉 인원수 가져오기
        getFollowingNum();
        // 팔로워 인원수 가져오기
        getFollowerNum();

        // ********** 클릭시 이벤트 **********

        // 팔로잉 버튼 클릭시 이벤트
        $('#followNum').on('click', function () {
            console.log("팔로잉 버튼 클릭");
            followingStart = 0;
            getFollowingListWithpaging();

        });

        // ********** 각종 함수들 **********

        // 팔로잉 하고 있는 인원수 가져오기
        function getFollowingNum() {
            $.ajax({
                type: 'GET',
                url: '/follows/' + memberIdVal + '/following',
                success: function (follow) {
                    console.log("팔로잉 리스트 가져오기 성공");
                    console.log(follow);
                    $('#followNum').text(follow.length + '명');
                },
                error: function (e) {
                    console.log("팔로잉 리스트 가져오기 실패");
                    console.log(e);
                }
            });
        }

        // 회원을 팔로우 하고 있는 인원수 가져오기
        function getFollowerNum() {
            $.ajax({
                type: 'GET',
                url: '/follows/' + memberIdVal + '/follower',
                success: function (follower) {
                    console.log("팔로워 리스트 가져오기 성공");
                    console.log(follower);
                    $('#followerNum').text(follower.length + '명');
                },
                error: function (e) {
                    console.log("팔로워 리스트 가져오기 실패");
                    console.log(e);
                }
            });
        }

        // 팔로잉 리스트 가져오기
        function getFollowingListWithpaging() {
            $.ajax({
                type: 'GET',
                url: '/follows/' + memberIdVal + '/following/' + followingStart,
                success: function (follow) {
                    console.log("팔로잉 리스트 가져오기 성공");
                    console.log(follow);


                    if (follow.length === 0) {
                        console.log("팔로잉 리스트가 없습니다.");
                    } else {
                        // 리스트
                        printFollowingList(follow);
                    }


                },
                error: function (e) {
                    console.log("팔로잉 리스트 가져오기 실패");
                    console.log(e);
                }
            });
        }

        // 팔로워 리스트 출력하기
        function printFollowingList(follow) {
           /* <div className="row">

                <!-- 프로필 -->
                <div className="col-2">
                    <i className="fa-solid fa-circle-user fa-2x d-flex justify-content-center align-items-center"></i>
                </div>

                <div className="col">
                    <div className="row d-flex justify-content-between align-items-center">
                        <!-- 닉네임, 지역 -->
                        <div className="col-auto">
                            <div className="input-group">
                                <button type="button" className="btn btn-outline-secondary">asd</button>
                                <span className="input-group-text">지역</span>
                            </div>
                        </div>

                        <!-- 팔로우 버튼 -->
                        <div className="col-auto">
                            <div className="input-group">
                                <button type="button" className="btn btn-dark">UnFollow</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>*/

            let followingListModalBody = $('#followingListModalBody');
            let html = '';
            for (let i = 0; i < follow.length; i++) {
                html += '<div class="row mt-2">';
                html += '<div class="col-2">';
                html += '<i class="fa-solid fa-circle-user fa-2x d-flex justify-content-center align-items-center"></i>';
                html += '</div>';
                html += '<div class="col">';
                html += '<div class="row d-flex justify-content-between align-items-center">';
                html += '<div class="col-auto">';
                html += '<div class="input-group">';
                html += '<button type="button" class="btn btn-outline-secondary">' + follow[i].followDTO.username + '</button>';
                let locationString = locationEnumToString(follow[i].followDTO.location);
                html += '<span class="input-group-text">' + locationString + '</span>';
                html += '</div>';
                html += '</div>';
                html += '<div class="col-auto">';
                html += '<div class="input-group">';
                html += '<button type="button" class="btn btn-dark">UnFollow</button>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            // 팔로잉 리스트 html 추가하기
            followingListModalBody.append(html);
        }

        // 팔로잉 모달이 닫힐 때 팔로잉 리스트 초기화
        $('#followList-modal').on('hidden.bs.modal', function () {
            $('#followingListModalBody').empty();
            followingStart = 0;
        });

        // 팔로잉 모달내에  스크롤이 바닥에 닿았을 때
        $('#followingListModalBody').on('scroll', function () {
            console.log("스크롤 이벤트 발생");
            let scrollHeight = $(this)[0].scrollHeight;
            let scrollTop = $(this).scrollTop();
            let followingListModalBodyHeight = $('#followingListModalBody').height();
            let padding_top = $('#followingListModalBody').css('padding-top');
            let padding_bottom = $('#followingListModalBody').css('padding-bottom');

            // padding-top, padding-bottom 값 제거
            padding_top = padding_top.replace('px', '');
            padding_bottom = padding_bottom.replace('px', '');
            // padding-top, padding-bottom 값 int로 변환
            padding_top = parseInt(padding_top);
            padding_bottom = parseInt(padding_bottom);
            followingListModalBodyHeight = followingListModalBodyHeight + padding_top + padding_bottom;

            // modal-body

            if (scrollTop + followingListModalBodyHeight+1 >= scrollHeight) {
                console.log("스크롤이 바닥에 닿았습니다.");
                followingStart += 20;
                getFollowingListWithpaging();
            }
        });


        // 지역 ENUM 값 변환
        function locationEnumToString(locationEnum) {
            switch (locationEnum) {
                case 'SEOUL':
                    return '서울';
                case 'BUSAN':
                    return '부산';
                case 'DAEGU':
                    return '대구';
                case 'INCHEON':
                    return '인천';
                case 'GWANGJU':
                    return '광주';
                case 'DAEJEON':
                    return '대전';
                case 'ULSAN':
                    return '울산';
                case 'SEJONG':
                    return '세종';
                case 'GYEONGGI':
                    return '경기';
                case 'KANGWON':
                    return '강원';
                case 'CHUNGBUK':
                    return '충북';
                case 'CHUNGNAM':
                    return '충남';
                case 'JEONBUK':
                    return '전북';
                case 'JEONNAM':
                    return '전남';
                case 'GYEONGBUK':
                    return '경북';
                case 'GYEONGNAM':
                    return '경남';
                case 'JEJU':
                    return '제주';
                default:
                    return '지역';
            }
        }



    });
</script>
</html>