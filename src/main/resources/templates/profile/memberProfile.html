<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<th:block th:replace="~{/layouts/base :: base(~{this::content})}">

    <th:block th:fragment="content">

        <!-- 팔로우 목록 모달 -->
        <div class="modal fade" id="followList-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5">내 팔로우 목록</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body container">

                        <!-- 팔로우 목록 양식-->
                        <div class="row">

                            <!-- 프로필 -->
                            <div class="col-2">
                                <i class="fa-solid fa-circle-user fa-2x d-flex justify-content-center align-items-center"></i>
                            </div>

                            <div class="col">

                                <div class="row d-flex justify-content-between align-items-center">

                                    <!-- 닉네임, 지역 -->
                                    <div class="col-auto">
                                        <div class="input-group">
                                            <button type="button" class="btn btn-outline-secondary">asd</button>
                                            <span class="input-group-text">지역</span>
                                        </div>
                                    </div>

                                    <!-- 팔로우 버튼 -->
                                    <div class="col-auto">
                                        <div class="input-group">
                                            <button type="button" class="btn btn-dark">UnFollow</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <!-- 팔로잉 모달 -->
        <div class="modal-dialog modal-dialog-scrollable"><!-- 스크롤 모달 -->
            <div class="modal fade" id="followingModal" tabindex="-1" role="dialog"
                 aria-labelledby="followingModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="followingModalLabel">팔로잉</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div id="followingList"></div>
                            </form>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div id="memberList"></div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- 스크롤 모달 -->

        <!-- 팔로워 모달 -->
        <div class="modal-dialog modal-dialog-scrollable"><!-- 스크롤 모달 -->
            <div class="modal fade" id="followerModal" tabindex="-1" role="dialog" aria-labelledby="followerModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="followerModalLabel">팔로워</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div id="followerList"></div>
                            </form>
                        </div>
                        <div class="modal-body">
                            <form>
                                <!--<div id="memberList"></div>-->
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- 스크롤 모달 -->


        <!-- TODO 마이페이지 기능 구현 및 디자인 -->

        <!-- 프로필 페이지 영역 -->
        <div class="container" id="profileWrapper">

            <!-- 기본 정보 영역 -->
            <div class="row mt-5">

                <!-- 프로필 & 기본 정보 -->
                <div class="row mt-4">

                    <!-- 프로필 이미지 -->
                    <div class="col-3">
                        <i class="fa-solid fa-circle-user fa-7x d-flex justify-content-center align-items-center"></i>
                    </div>

                    <!-- 프로필 정보 -->
                    <div class="col-9">
                        <!-- 닉네임, 팔로우, 팔로워 -->
                        <div class="row">
                            <!-- 닉네임 -->
                            <div class="col-auto">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">닉네임</span>
                                    <span class="form-control" th:text="${member.username}"></span>
                                </div>
                            </div>
                            <!-- 팔로우 -->
                            <div class="col">
                                <div class="input-group input-group-lg d-flex justify-content-center align-items-center">
                                    <span class="input-group-text">팔로우</span>
                                    <button type="button" id="followNum" data-bs-target="#followList-modal" data-bs-toggle="modal" class="btn btn-outline-secondary">10명</button>
                                </div>

                            </div>
                            <!-- 팔로워 -->
                            <div class="col">
                                <div class="input-group input-group-lg d-flex justify-content-center align-items-center">
                                    <span class="input-group-text">팔로워</span>
                                    <button type="button" id="followerNum" class="btn btn-outline-secondary">10명
                                    </button>
                                </div>
                            </div>

                            <!-- 수정 버튼 -->
                            <div class="col-auto">
                                <div class="input-group input-group-lg">
                                    <button type="button" class="btn btn-dark"
                                            th:onclick="|location.href='@{/members/{id}/edit(id=${member.id})}'|">수정
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 지역, 자기소개 -->
                        <div class="row mt-3">

                            <div class="col-auto">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text" th:text="${member.location.value}">지역</span>
                                </div>
                            </div>

                            <div class="col">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">자기소개</span>
                                    <span class="form-control" th:text="${member.introduction}"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- 필터 영역 -->
                <div class="row mt-5">

                    <!-- 동적 제목 -->
                    <div class="col-3">
                        <div class="input-group input-group-lg w-100 h-100">
                            <span class="btn btn-secondary w-100 h-100 fs-2 d-flex justify-content-center align-items-center">카테고리</span>
                        </div>
                    </div>

                    <!-- 필터 버튼 -->
                    <!-- 나 : 후기, 정보, 작품, 신청한 모임 일정, 등록한 모임 일정 -->
                    <!-- 북마크 : 후기, 정보, 작품, 모임 -->
                    <!-- 타임 라인 : 후기, 정보, 작품 -->
                    <div class="col-9">
                        <div class="row">
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-4">나</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-4">북마크</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-4">타임라인</button>
                            </div>
                            <div class="col"></div>
                            <div class="col"></div>
                        </div>

                        <!-- 세부 동적 필터 -->
                        <div class="row mt-3">
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">후기</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">정보</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">작품</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">신청한 모임</button>
                            </div>
                            <div class="col">
                                <button type="button" class="btn btn-outline-secondary w-100 fs-6">등록한 모임</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 카드 영역 -->
            <div id="content-area" class="mt-4">

                <div id="contentTest">asdasd</div>

            </div>


        </div>

        <!--  무한 스크롤 영역  -->


    </th:block>
</th:block>
<script th:inline="javascript">
    $(document).ready(function () {
        let memberIdVal = [[${member.id}]];

        console.log("memberIdVal : " + memberIdVal);

        let flowListDiv = $('#followingList');
        let FlwerListDiv = $('#followerList');
        let memberListDiv = $('#memberList');
        getFollowingList();
        getFollowerList();

        function getFollowingList() {
            $.ajax({
                type: 'GET',
                url: '/follows/' + memberIdVal + '/following',
                success: function (follow) {
                    console.log("팔로잉 리스트 가져오기 성공");
                    console.log(follow);
                    $('#followNum').text(follow.length + '명');
                },
                error: function (e) {
                    console.log("팔로잉 리스트 가져오기 실패");
                    console.log(e);
                }
            });
        }

        function getFollowerList() {
            $.ajax({
                type: 'GET',
                url: '/follows/' + memberIdVal + '/follower',
                success: function (follower) {
                    console.log("팔로워 리스트 가져오기 성공");
                    console.log(follower);
                    $('#followerNum').text(follower.length + '명');
                },
                error: function (e) {
                    console.log("팔로워 리스트 가져오기 실패");
                    console.log(e);
                }
            });
        }


        function printFollowingList(listFollowing) {
            console.log("팔로잉 리스트 출력");
            console.log(listFollowing);
            let html = '';
            for (let i = 0; i < listFollowing.length; i++) {
                html += '<div name="member">';
                html += '<span name="memberImage"></span>';
                html += '<span name="memberInfo">';
                html += '<div name="username">닉네임 ' + listFollowing[i].username + '</div>';
                html += '<div name="memberInfoBottom">';
                html += '<span name="location">지역 ' + listFollowing[i].location + '</span>';
                html += '<span name="introduce">자기소개 ' + listFollowing[i].introduction + '</span>';
                html += '</div></span></div>';
                html += '<span name="follow-button"></span>';
                html += '<button type="button" class="btn btn-info unFollowBtn" data-unflowbtn="' + listFollowing[i].id + '">팔로잉</button>';
            }
            flowListDiv.html(html);
        }

        function printMemberList(memberList) {
            let html = '';
            for (let i = 0; i < memberList.length; i++) {
                html += '<div name="member">';
                html += '<span name="memberImage"></span>';
                html += '<span name="memberInfo">';
                html += '<div name="username">닉네임' + memberList[i].username + '</div>';
                html += '<div name="memberInfoBottom">';
                html += '<span name="location">지역' + memberList[i].location + '</span>';
                html += '<span name="introduce">자기소개' + memberList[i].introduction + '</span>';
                html += '</div></span></div>';
                html += '<span name="follow-button"></span>';
                html += '<button type="button" class="btn btn-primary followBtn" data-flwbtn="' + memberList[i].id + '">팔로우</button>';
            }
            memberListDiv.html(html);
        }

        function printFollowerList(listFollower) {
            console.log("팔로워 리스트 출력");
            console.log(listFollower);
            let html = '';
            for (let i = 0; i < listFollower.length; i++) {
                html += '<div name="member">';
                html += '<span name="memberImage"></span>';
                html += '<span name="memberInfo">';
                html += '<div name="username">닉네임 ' + listFollower[i].username + '</div>';
                html += '<div name="memberInfoBottom">';
                html += '<span name="location">지역 ' + listFollower[i].location + '</span>';
                html += '<span name="introduce">자기소개 ' + listFollower[i].introduction + '</span>';
                html += '</div></span></div>';
                html += '<span name="follow-button"></span>';
                if (listFollower[i].id == null) {
                    html += '<button type="button" class="btn btn-info unFollowBtn" data-unflowbtn="' + listFollower[i].id + '">팔로잉</button>';
                } else {
                    html += '<button type="button" class="btn btn-primary followBtn" data-flwbtn="' + listFollower[i].id + '">팔로우</button>';
                }
            }
            FlwerListDiv.html(html);
        }
    });
</script>
</html>