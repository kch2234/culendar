<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<th:block th:replace="~{/layouts/base :: base(~{this::content})}">
    <th:block th:fragment="content">
        <!--  TODO 텍스트 에디터 API  -->

        <div class="untree_co-hero py-5 mb-0" id="home-section">  <!--  배경 영역  -->
            <div class="container pb-5 mb-5 border-bottom">  <!--  게시글 작성  -->
                <div class="row">
                    <div class="col-lg-7">
                        <form action="" th:action th:object="${eventBoardForm}" method="post">
                            <div class="form-group">
                                <label class="text-blank" for="title">제목</label>
                                <input type="text" th:field="*{title}" class="form-control" id="title">
                            </div>
                            <div class="row mb-4">
                                <div class="col-12 input-group input-group-lg">

                                    <!-- 작품 선택 -->
                                    <label for="search-text" class="input-group-text">작품 선택</label>
                                    <!--  체크 박스  -->
                                    <div class="input-group-text">
                                        <input class="form-check-input mt-0"
                                               id="programSelectCheck"
                                               type="checkbox"
                                               th:field="*{programId}"
                                               value="">
                                    </div>
                                    <!--  검색창  -->
                                    <input type="text"
                                           id="search-text"
                                           class="form-control dropdown-toggle search-input"
                                           data-bs-toggle="dropdown"
                                           aria-expanded="false">
                                    <ul class="dropdown-menu overflow-scroll" id="searched-list">
                                        <!-- 동적으로 드롭다운 검색 결과 -->
                                    </ul>

                                    <!--  모임 날짜  -->
                                    <div class="form-group">
                                        <label class="text-blank" for="eventDate">날짜</label>
                                        <input type="date" th:field="*{eventDate}" class="form-control" id="eventDate">
                                    </div>
                                    <!--  모임 마감 일자  -->
                                    <div class="form-group">
                                        <label class="text-blank" for="deadlineDate">모집 마감 : </label>
                                        <span>모임</span><input type="number" id="deadlineDate" th:field="*{deadlineDate}" min="2" max="31" value="2"><span>일 전</span>
                                    </div>
                                    <!--  달력형 모집 마감 일자  -->
<!--                                    <div class="form-group">-->
<!--                                        <label class="text-blank" for="deadlineDate">모집 마감 일자</label>-->
<!--                                        <input type="date" th:field="*{deadlineDate}" class="form-control" id="deadlineDate">-->
<!--                                    </div>-->

                                    <div class="form-group">
                                        <label class="text-blank" for="maxPeople">최대 인원</label>
                                        <input type="number"
                                               th:field="*{maxPeople}"
                                               class="form-control"
                                               min="2"
                                               id="maxPeople">
                                    </div>
                                    <div class="form-group">
                                        <label class="filter">필터링
                                            <label class="text-blank" for="filterGender">성별</label>
                                            <select class="custom-select" th:field="*{filterGender}" id="filterGender">
                                                <!--                                        <option value="">성별 선택</option>-->
                                                <option th:each="filterGender: ${filterGender}"
                                                        th:value="${filterGender.name()}"
                                                        th:text="${filterGender.value}"
                                                        th:selected="${filterGender.name()} == 'ALL'">
                                                    <!-- TODO 기본 선택값   -->
                                                </option>
                                            </select>
                                            <label class="text-blank" for="filterMaxAge">최대나이</label>
                                            <input type="number"
                                                   th:field="*{filterMaxAge}"
                                                   class="form-control"
                                                   min="0"
                                                   id="filterMaxAge">
                                            <label class="text-blank" for="filterMinAge">최소나이</label>
                                            <input type="number"
                                                   th:field="*{filterMinAge}"
                                                   class="form-control"
                                                   min="0"
                                                   id="filterMinAge">
                                        </label>
                                    </div>

                                    <!--                            <input type="text" id="demo" name="demo" value=""/>  &lt;!&ndash;  TODO 기간 설정 시 date range picker 사용  &ndash;&gt;-->
                                    <!--  toggle todo DB연결  -->
                                    <label for="autoAccept">자동 수락 여부 toggle</label>
                                    <input type="checkbox" name="autoAccept" value="true" id="autoAccept" checked>
<!--                                    <div class="form-group">-->
<!--                                        <label class="text-blank" for="thumbnail">썸네일 이미지</label>-->
<!--                                        <input type="file" th:field="*{thumbnail}" class="form-control" id="thumbnail">-->
<!--                                    </div>  &lt;!&ndash;  todo 이미지 첨부 기능 예정  &ndash;&gt;-->
<!--                                    <div class="form-group">-->
<!--                                        <label class="text-blank" for="image">본문 이미지 첨부</label>-->
<!--                                        <input type="file" th:field="*{image}" class="form-control" id="image">-->
<!--                                    </div>  &lt;!&ndash;  todo 이미지 첨부 기능 예정  &ndash;&gt;-->
                                    <div class="form-group">
                                        <label class="text-blank" for="content">내용</label>
                                        <textarea th:field="*{content}"
                                                  class="form-control"
                                                  id="content"
                                                  rows="10"
                                                  maxlength="4000"></textarea>
                                    </div>
                                    <button type="button"
                                            class="btn btn-info"
                                            th:onclick="|location.href='@{/clubs/list}'|">
                                        취소
                                    </button>
                                    <button type="submit" class="btn btn-primary">등록</button>
                        </form>
                    </div>  <!--  col-lg-7  -->
                </div>  <!--  row  -->
            </div>  <!--  container 게시글 작성  -->
        </div>  <!-- untree_co-hero py-5 mb-0 배경 영역   -->

        <script th:inline="javascript">
            $(document).ready(function () {
                var programId = null;

                // 작품 분류 선택시 값 변경
                $('.dropdown-menu').on('click', '.boardTypeValue', function () {
                    // 버튼 기본 기능 비활성화
                    event.preventDefault();
                // #dropdown-menu 값 변경
                $('#boardTypeValue').val($(this).data('type'));
                // 버튼 텍스트 변경
                $('.bTypeBtn').text($(this).text());
                // #boardType 값 변경
                $('#boardType').val($(this).data('type'));
                });

                // 검색창에 값변경시
                $('#search-text').on('keyup', function () {
                    console.log($(this).val());
                    $.ajax({
                        url: '/program/search/' + $(this).val(),
                        type: 'GET',
                        success: function (data) {
                            console.log(data);
                            changeDropdown(data);
                            programId = null;
                            // 드롭다운 보여주기
                            $('#searched-list').css('display', 'block')
                            console.log(programId);
                        }
                    });
                });

                // 드롭다운 내부 값 변경
                function changeDropdown(data) {
                    let html = '';
                    data.forEach(function (program) {
                        html += '<li><a class="dropdown-item search-value" href="#" data-programId="' + program.id + '">' + program.title + '</a></li>';
                    });
                    $('#searched-list').html(html);
                }

                // 드롭다운 내부 클릭시 input에 값 넣기
                $(document).on('click', '.search-value', function () {
                    console.log($(this).text());
                    $('#search-text').val($(this).text());
                    programId = $(this).data('programid');
                    $('#searched-list').css('display', 'none');
                });


                // #search-list 외부 클릭과 #search-text 포커스 아웃시 드롭다운 숨기기
                $(document).on('click', function (e) {
                    if (!$(e.target).closest('#searched-list').length && !$(e.target).closest('#search-text').length) {
                        $('#searched-list').css('display', 'none');
                    }
                });
                // #search-text 포커스시 드롭다운 보여주기
                $('#search-text').on('focus', function () {
                    $('#searched-list').css('display', 'block');
                });

                // 체크박스 클릭시
                $('#programSelectCheck').on('click', function () {
                    if (programId == null) {
                        alert('작품을 선택해주세요');
                        $('#programSelectCheck').prop('checked', false);
                    } else if ($('#programSelectCheck').val() == programId) {
                        // 체크박스 값 변경
                        $('#programSelectCheck').val('');
                        // readonly 속성 제거
                        $('#search-text').prop('readonly', false);
                        $('#programSelectCheck').prop('checked', false);
                        console.log($('#programSelectCheck').val());
                    } else {
                        // 체크박스 값 변경
                        $('#programSelectCheck').val(programId);
                        // readonly 속성 추가
                        $('#search-text').prop('readonly', true);
                        console.log($('#programSelectCheck').val());
                    }
                });

                // 현재 날짜 계산
                var now_utc = Date.now();
                var timeOff = new Date().getTimezoneOffset() * 60000;
                var today = new Date(now_utc - timeOff);

                // minEventDate = today + 2
                var minEventDate = new Date(today);
                minEventDate.setDate(today.getDate() + 2);
                var minEventDateISOString = minEventDate.toISOString().split("T")[0];
                document.getElementById("eventDate").setAttribute("min", minEventDateISOString);

<!--                // eventDate에 사용자 입력 값 지정-->
<!--                document.getElementById("eventDate").addEventListener("change", function() {-->
<!--                    var eventDateValue = this.value;-->
<!--                    var eventDate = new Date(eventDateValue);-->
<!---->
<!--                    // minDeadlineDate = minEventDate + 2-->
<!--                    var minDeadlineDate = new Date(eventDate);-->
<!--                    minDeadlineDate.setDate(eventDate.getDate() + 2);-->
<!--                    var minDeadlineDateISOString = minDeadlineDate.toISOString().split("T")[0];-->
<!--                    document.getElementById("deadlineDate").setAttribute("min", minDeadlineDateISOString);-->
<!--                });-->

            });
        </script>

    </th:block>
</th:block>
</html>